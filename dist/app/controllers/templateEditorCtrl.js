/*! grafana - v1.8.0 - 2014-09-08
 * Copyright (c) 2014 Torkel Ã–degaard; Licensed Apache License */

define(["angular","lodash"],function(a,b){var c=a.module("grafana.controllers");c.controller("TemplateEditorCtrl",["$scope","datasourceSrv","templateSrv","templateValuesSrv","alertSrv",function(c,d,e,f,g){var h={type:"query",datasource:null,refresh_on_load:!1,name:"",options:[],includeAll:!1,allFormat:"glob"};c.init=function(){c.editor={index:0},c.datasources=d.getMetricSources(),c.variables=e.variables,c.reset(),c.$watch("editor.index",function(a){c.currentIsNew===!1&&1===a&&c.reset()})},c.add=function(){c.variables.push(c.current),c.update()},c.runQuery=function(){return f.updateOptions(c.current).then(function(){},function(a){g.set("Templating","Failed to run query for variable values: "+a.message,"error")})},c.edit=function(a){c.current=a,c.currentIsNew=!1,c.editor.index=2,void 0===c.current.datasource&&(c.current.datasource=null,c.current.type="query",c.current.allFormat="Glob")},c.update=function(){c.runQuery().then(function(){c.reset(),c.editor.index=0})},c.reset=function(){c.currentIsNew=!0,c.current=a.copy(h)},c.typeChanged=function(){"interval"===c.current.type&&(c.current.query="1m,10m,30m,1h,6h,12h,1d,7d,14d,30d")},c.removeVariable=function(a){var d=b.indexOf(c.variables,a);c.variables.splice(d,1)}}])});