/*! grafana - v1.8.0 - 2014-09-08
 * Copyright (c) 2014 Torkel Ã–degaard; Licensed Apache License */

define(["angular","jquery","config","lodash","services/all"],function(a,b,c,d){var e=a.module("grafana.controllers");e.controller("DashboardCtrl",["$scope","$rootScope","dashboardKeybindings","timeSrv","templateValuesSrv","dashboardSrv","dashboardViewStateSrv","panelMoveSrv","timer","$timeout",function(b,e,f,g,h,i,j,k,l,m){b.editor={index:0},b.panelNames=c.panels;var n;b.init=function(){b.availablePanels=c.panels,b.onAppEvent("setup-dashboard",b.setupDashboard),b.onAppEvent("show-json-editor",b.showJsonEditor),b.reset_row(),b.registerWindowResizeEvent()},b.registerWindowResizeEvent=function(){a.element(window).bind("resize",function(){m.cancel(n),n=m(function(){b.$broadcast("render")},200)})},b.setupDashboard=function(a,c){e.performance.dashboardLoadStart=(new Date).getTime(),e.performance.panelsInitialized=0,e.performance.panelsRendered=0,b.dashboard=i.create(c),b.dashboardViewState=j.create(b),g.init(b.dashboard),h.init(b.dashboard,b.dashboardViewState),k.init(b.dashboard,b),b.checkFeatureToggles(),f.shortcuts(b),b.setWindowTitleAndTheme(),b.emitAppEvent("dashboard-loaded",b.dashboard)},b.setWindowTitleAndTheme=function(){window.document.title=c.window_title_prefix+b.dashboard.title,b.grafana.style=b.dashboard.style},b.isPanel=function(a){return d.isNull(a)||d.isUndefined(a)||d.isUndefined(a.type)?!1:!0},b.add_row=function(a,b){a.rows.push(b)},b.add_row_default=function(){b.reset_row(),b.row.title="New row",b.add_row(b.dashboard,b.row)},b.reset_row=function(){b.row={title:"",height:"250px",editable:!0}},b.edit_path=function(a){var c=b.panel_path(a);return c?c+"/editor.html":!1},b.showJsonEditor=function(a,c){var d=e.$new();d.object=c.object,d.updateHandler=c.updateHandler,b.emitAppEvent("show-dash-editor",{src:"app/partials/edit_json.html",scope:d})},b.checkFeatureToggles=function(){b.submenuEnabled=b.dashboard.templating.enable||b.dashboard.annotations.enable},b.setEditorTabs=function(a){return b.editorTabs=["General","Panel"],d.isUndefined(a.editorTabs)||(b.editorTabs=d.union(b.editorTabs,d.pluck(a.editorTabs,"title"))),b.editorTabs},b.init()}])});